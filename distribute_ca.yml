- name: Distribute CA certificate to all hosts
  hosts: all
  become: yes
  tasks:
    - name: Copy CA certificate to hosts
      ansible.builtin.copy:
        src: /etc/pki/tls/certs/CA_cert.pem
        dest: "{{ ca_path }}/CA_cert.pem"
        owner: root
        group: root
        mode: '0644'

    - name: Update CA trust on Fedora
      ansible.builtin.command:
        cmd: update-ca-trust
      changed_when: true
      when: "'fedora' in group_names"

    - name: Update CA certificates on Debian
      ansible.builtin.command:
        cmd: update-ca-certificates
      changed_when: true
      when: "'debian' in group_names"
